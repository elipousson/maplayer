<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Layer for counting occurrences of data in spatial relation a location or other sf object — layer_count • maplayer</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Layer for counting occurrences of data in spatial relation a location or other sf object — layer_count"><meta name="description" content="Wraps sfext::count_sf_ext(). Specification of parameters for this function
may be too complex and may be changed in the future."><meta property="og:description" content="Wraps sfext::count_sf_ext(). Specification of parameters for this function
may be too complex and may be changed in the future."><meta property="og:image" content="https://elipousson.github.io/maplayer/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">maplayer</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0.9003</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/elipousson/maplayer/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Layer for counting occurrences of data in spatial relation a location or other sf object</h1>
      <small class="dont-index">Source: <a href="https://github.com/elipousson/maplayer/blob/main/R/layer_count.R" class="external-link"><code>R/layer_count.R</code></a></small>
      <div class="d-none name"><code>layer_count.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Wraps <code><a href="https://elipousson.github.io/sfext/reference/count_sf_ext.html" class="external-link">sfext::count_sf_ext()</a></code>. Specification of parameters for this function
may be too complex and may be changed in the future.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">layer_count</span><span class="op">(</span></span>
<span>  <span class="va">data</span>,</span>
<span>  location <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  y <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  join <span class="op">=</span> <span class="fu">sf</span><span class="fu">::</span><span class="va"><a href="https://r-spatial.github.io/sf/reference/geos_binary_pred.html" class="external-link">st_intersects</a></span>,</span>
<span>  largest <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  replace_na <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  lims <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  .id <span class="op">=</span> <span class="st">"id"</span>,</span>
<span>  grid_params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">1</span>, color <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span>,</span>
<span>  show_data <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  data_params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">0.75</span>, size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>  show_label <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  label_params <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  scale_fn <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="va"><a href="https://ggplot2.tidyverse.org/reference/scale_colour_continuous.html" class="external-link">scale_fill_continuous</a></span>,</span>
<span>  scale_params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"viridis"</span>, breaks <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/breaks_pretty.html" class="external-link">breaks_pretty</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">4</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-data">data<a class="anchor" aria-label="anchor" href="#arg-data"></a></dt>
<dd><p>Data to count in relationship to y</p></dd>


<dt id="arg-location">location<a class="anchor" aria-label="anchor" href="#arg-location"></a></dt>
<dd><p>Passed to x parameter of <code><a href="https://elipousson.github.io/sfext/reference/count_sf_ext.html" class="external-link">sfext::count_sf_ext()</a></code>.</p></dd>


<dt id="arg-y">y<a class="anchor" aria-label="anchor" href="#arg-y"></a></dt>
<dd><p>If <code>NULL</code> (default), y defaults to an <code>sf</code> object created by
<code><a href="https://elipousson.github.io/sfext/reference/st_make_grid_ext.html" class="external-link">st_make_grid_ext()</a></code> using x or data (if x is <code>NULL</code>) as the x parameter
for <code><a href="https://elipousson.github.io/sfext/reference/st_make_grid_ext.html" class="external-link">st_make_grid_ext()</a></code>. If not <code>NULL</code>, y must be an <code>sf</code> object that has
a column with the same name as .id (defaults to "id").</p></dd>


<dt id="arg-join">join<a class="anchor" aria-label="anchor" href="#arg-join"></a></dt>
<dd><p>geometry predicate function with the same profile as <a href="https://r-spatial.github.io/sf/reference/geos_binary_pred.html" class="external-link">st_intersects</a>; see details</p></dd>


<dt id="arg-largest">largest<a class="anchor" aria-label="anchor" href="#arg-largest"></a></dt>
<dd><p>logical; if <code>TRUE</code>, return <code>x</code> features augmented with the fields of <code>y</code> that have the largest overlap with each of the features of <code>x</code>; see https://github.com/r-spatial/sf/issues/578</p></dd>


<dt id="arg-replace-na">replace_na<a class="anchor" aria-label="anchor" href="#arg-replace-na"></a></dt>
<dd><p>If <code>TRUE</code>, replace NA values from count with 0.</p></dd>


<dt id="arg-lims">lims<a class="anchor" aria-label="anchor" href="#arg-lims"></a></dt>
<dd><p>Optional numeric vector with minimum or both minimum and
maximum count values. If provided, any values below the minimum are set to
that minimum and any values above the maximum as set to the maximum. If
only one value is provided, it is assumed to be a minimum limit.</p></dd>


<dt id="arg--id">.id<a class="anchor" aria-label="anchor" href="#arg--id"></a></dt>
<dd><p>A name to use for the cell id column. Defaults to "id".</p></dd>


<dt id="arg-grid-params">grid_params<a class="anchor" aria-label="anchor" href="#arg-grid-params"></a></dt>
<dd><p>Passed to <code><a href="layer_location_data.html">layer_location_data()</a></code> to style foreground grid
with fill based on count.</p></dd>


<dt id="arg-show-data">show_data<a class="anchor" aria-label="anchor" href="#arg-show-data"></a></dt>
<dd><p>If <code>TRUE</code>, add background layer with data to stack returned
by function. If <code>TRUE</code> and grid_params includes a fixed aesthetic for
alpha, divide alpha in half to ensure background data is visible below the
filled grid.</p></dd>


<dt id="arg-data-params">data_params<a class="anchor" aria-label="anchor" href="#arg-data-params"></a></dt>
<dd><p>Passed to <code><a href="layer_location_data.html">layer_location_data()</a></code> to style background
layer based on data.</p></dd>


<dt id="arg-show-label">show_label<a class="anchor" aria-label="anchor" href="#arg-show-label"></a></dt>
<dd><p>If <code>TRUE</code>, add layer with labels to stack returned by
function.</p></dd>


<dt id="arg-label-params">label_params<a class="anchor" aria-label="anchor" href="#arg-label-params"></a></dt>
<dd><p>Passed to <code><a href="layer_labelled.html">layer_labelled()</a></code> for foreground labels with
fill based on count.</p></dd>


<dt id="arg-scale-fn-scale-params">scale_fn, scale_params<a class="anchor" aria-label="anchor" href="#arg-scale-fn-scale-params"></a></dt>
<dd><p>Scale function and parameters. Defaults to
<code><a href="https://ggplot2.tidyverse.org/reference/scale_colour_continuous.html" class="external-link">ggplot2::scale_fill_continuous()</a></code>.</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>Arguments passed on to <code><a href="https://elipousson.github.io/sfext/reference/count_sf_ext.html" class="external-link">sfext::count_sf_ext</a></code></p><dl><dt><code>wt</code></dt>
<dd><p>&lt;<code><a href="https://rlang.r-lib.org/reference/args_data_masking.html" class="external-link">data-masking</a></code>&gt; Frequency weights.
Can be <code>NULL</code> or a variable:</p><ul><li><p>If <code>NULL</code> (the default), counts the number of rows in each group.</p></li>
<li><p>If a variable, computes <code>sum(wt)</code> for each group.</p></li>
</ul></dd>

    <dt><code>sort</code></dt>
<dd><p>If <code>TRUE</code>, will show the largest groups at the top.</p></dd>

    <dt><code>keep_na</code></dt>
<dd><p>If <code>TRUE</code>, filter NA values from count. Ignored if replace_na
is <code>TRUE</code>.</p></dd>

    <dt><code>geometry</code></dt>
<dd><p>If <code>TRUE</code> (default) return a <code>sf</code> object. If <code>FALSE</code>, return
a data frame.</p></dd>

    <dt><code>name</code></dt>
<dd><p>The name of the new column in the output.</p>
<p>If omitted, it will default to <code>n</code>. If there's already a column called <code>n</code>,
it will use <code>nn</code>. If there's a column called <code>n</code> and <code>nn</code>, it'll use
<code>nnn</code>, and so on, adding <code>n</code>s until it gets a new name.</p></dd>


</dl></dd>

</dl></div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">nc</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">read_sf</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"shape/nc.shp"</span>, package <span class="op">=</span> <span class="st">"sf"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_sample.html" class="external-link">st_sample</a></span><span class="op">(</span><span class="va">nc</span>, <span class="fl">75</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span></span>
<span class="r-in"><span>  <span class="fu">layer_count</span><span class="op">(</span>data <span class="op">=</span> <span class="va">data</span>, location <span class="op">=</span> <span class="va">nc</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="layer_count-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span></span>
<span class="r-in"><span>  <span class="fu">layer_count</span><span class="op">(</span>data <span class="op">=</span> <span class="va">data</span>, y <span class="op">=</span> <span class="va">nc</span>, .id <span class="op">=</span> <span class="st">"FIPS"</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="layer_count-2.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Eli Pousson.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer></div>





  </body></html>

