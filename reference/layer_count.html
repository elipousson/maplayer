<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="Wraps sfext::count_sf_ext(). Specification of parameters for this function
may be too complex and may be changed in the future."><title>Layer for counting occurrences of data in spatial relation a location or other
sf object — layer_count • maplayer</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Layer for counting occurrences of data in spatial relation a location or other
sf object — layer_count"><meta property="og:description" content="Wraps sfext::count_sf_ext(). Specification of parameters for this function
may be too complex and may be changed in the future."><meta property="og:image" content="https://elipousson.github.io/maplayer/logo.png"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">maplayer</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0.9001</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/elipousson/maplayer/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Layer for counting occurrences of data in spatial relation a location or other
sf object</h1>
      <small class="dont-index">Source: <a href="https://github.com/elipousson/maplayer/blob/HEAD/R/layer_count.R" class="external-link"><code>R/layer_count.R</code></a></small>
      <div class="d-none name"><code>layer_count.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Wraps <code><a href="https://elipousson.github.io/sfext/reference/count_sf_ext.html" class="external-link">sfext::count_sf_ext()</a></code>. Specification of parameters for this function
may be too complex and may be changed in the future.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">layer_count</span><span class="op">(</span></span>
<span>  <span class="va">data</span>,</span>
<span>  location <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  y <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  join <span class="op">=</span> <span class="fu">sf</span><span class="fu">::</span><span class="va"><a href="https://r-spatial.github.io/sf/reference/geos_binary_pred.html" class="external-link">st_intersects</a></span>,</span>
<span>  largest <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  replace_na <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  lims <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  .id <span class="op">=</span> <span class="st">"id"</span>,</span>
<span>  grid_params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">1</span>, color <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span>,</span>
<span>  show_data <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  data_params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">0.75</span>, size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>  show_label <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  label_params <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  scale_fn <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="va"><a href="https://ggplot2.tidyverse.org/reference/scale_colour_continuous.html" class="external-link">scale_fill_continuous</a></span>,</span>
<span>  scale_params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"viridis"</span>, breaks <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/breaks_pretty.html" class="external-link">breaks_pretty</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">4</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>data</dt>
<dd><p>Data to count in relationship to y</p></dd>


<dt>location</dt>
<dd><p>Passed to x parameter of <code><a href="https://elipousson.github.io/sfext/reference/count_sf_ext.html" class="external-link">sfext::count_sf_ext()</a></code>.</p></dd>


<dt>y</dt>
<dd><p>If <code>NULL</code> (default), y defaults to an <code>sf</code> object created by
<code><a href="https://elipousson.github.io/sfext/reference/st_make_grid_ext.html" class="external-link">st_make_grid_ext()</a></code> using x or data (if x is <code>NULL</code>) as the x parameter
for <code><a href="https://elipousson.github.io/sfext/reference/st_make_grid_ext.html" class="external-link">st_make_grid_ext()</a></code>. If not <code>NULL</code>, y must be an <code>sf</code> object that has
a column with the same name as .id (defaults to "id").</p></dd>


<dt>join</dt>
<dd><p>geometry predicate function with the same profile as <a href="https://r-spatial.github.io/sf/reference/geos_binary_pred.html" class="external-link">st_intersects</a>; see details</p></dd>


<dt>largest</dt>
<dd><p>logical; if <code>TRUE</code>, return <code>x</code> features augmented with the fields of <code>y</code> that have the largest overlap with each of the features of <code>x</code>; see https://github.com/r-spatial/sf/issues/578</p></dd>


<dt>replace_na</dt>
<dd><p>If <code>TRUE</code>, replace NA values from count with 0.</p></dd>


<dt>lims</dt>
<dd><p>Optional numeric vector with minimum or both minimum and
maximum count values. If provided, any values below the minimum are set to
that minimum and any values above the maximum as set to the maximum. If
only one value is provided, it is assumed to be a minimum limit.</p></dd>


<dt>.id</dt>
<dd><p>A name to use for the cell id column. Defaults to "id".</p></dd>


<dt>grid_params</dt>
<dd><p>Passed to <code><a href="layer_location_data.html">layer_location_data()</a></code> to style foreground grid
with fill based on count.</p></dd>


<dt>show_data</dt>
<dd><p>If <code>TRUE</code>, add background layer with data to stack returned
by function. If <code>TRUE</code> and grid_params includes a fixed aesthetic for
alpha, divide alpha in half to ensure background data is visible below the
filled grid.</p></dd>


<dt>data_params</dt>
<dd><p>Passed to <code><a href="layer_location_data.html">layer_location_data()</a></code> to style background
layer based on data.</p></dd>


<dt>show_label</dt>
<dd><p>If <code>TRUE</code>, add layer with labels to stack returned by
function.</p></dd>


<dt>label_params</dt>
<dd><p>Passed to <code><a href="layer_labelled.html">layer_labelled()</a></code> for foreground labels with
fill based on count.</p></dd>


<dt>scale_fn, scale_params</dt>
<dd><p>Scale function and parameters. Defaults to
<code><a href="https://ggplot2.tidyverse.org/reference/scale_colour_continuous.html" class="external-link">ggplot2::scale_fill_continuous()</a></code>.</p></dd>


<dt>...</dt>
<dd><p>Arguments passed on to <code><a href="https://elipousson.github.io/sfext/reference/count_sf_ext.html" class="external-link">sfext::count_sf_ext</a></code></p><dl><dt><code>wt</code></dt>
<dd><p>&lt;<code><a href="https://rlang.r-lib.org/reference/args_data_masking.html" class="external-link">data-masking</a></code>&gt; Frequency weights.
Can be <code>NULL</code> or a variable:</p><ul><li><p>If <code>NULL</code> (the default), counts the number of rows in each group.</p></li>
<li><p>If a variable, computes <code>sum(wt)</code> for each group.</p></li>
</ul></dd>

    <dt><code>sort</code></dt>
<dd><p>If <code>TRUE</code>, will show the largest groups at the top.</p></dd>

    <dt><code>keep_na</code></dt>
<dd><p>If <code>TRUE</code>, filter NA values from count. Ignored if replace_na
is <code>TRUE</code>.</p></dd>

    <dt><code>geometry</code></dt>
<dd><p>If <code>TRUE</code> (default) return a <code>sf</code> object. If <code>FALSE</code>, return
a data frame.</p></dd>

    <dt><code>name</code></dt>
<dd><p>The name of the new column in the output.</p>
<p>If omitted, it will default to <code>n</code>. If there's already a column called <code>n</code>,
it will use <code>nn</code>. If there's a column called <code>n</code> and <code>nn</code>, it'll use
<code>nnn</code>, and so on, adding <code>n</code>s until it gets a new name.</p></dd>

  
</dl></dd>

</dl></div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">nc</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">st_read</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"shape/nc.shp"</span>, package <span class="op">=</span> <span class="st">"sf"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Reading layer `nc' from data source </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   `/home/runner/work/_temp/Library/sf/shape/nc.shp' using driver `ESRI Shapefile'</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Simple feature collection with 100 features and 14 fields</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Geometry type: MULTIPOLYGON</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Dimension:     XY</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Bounding box:  xmin: -84.32385 ymin: 33.88199 xmax: -75.45698 ymax: 36.58965</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Geodetic CRS:  NAD27</span>
<span class="r-in"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_sample.html" class="external-link">st_sample</a></span><span class="op">(</span><span class="va">nc</span>, <span class="fl">75</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span></span>
<span class="r-in"><span>  <span class="fu">layer_count</span><span class="op">(</span>data <span class="op">=</span> <span class="va">data</span>, location <span class="op">=</span> <span class="va">nc</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="layer_count-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span></span>
<span class="r-in"><span>  <span class="fu">layer_count</span><span class="op">(</span>data <span class="op">=</span> <span class="va">data</span>, y <span class="op">=</span> <span class="va">nc</span>, .id <span class="op">=</span> <span class="st">"FIPS"</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="layer_count-2.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by Eli Pousson.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer></div>

  

  

  </body></html>

